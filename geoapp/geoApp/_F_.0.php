<?php global $_m¬SS;$_u¬FN=strtoupper('REGCLINAV');$_m¬SS->FND[strtoupper(_¬getPath($_u¬FN))]=new _¬NtvFunction($_u¬FN,strtoupper(trim('RET')),array('CLIPSCOD','CLIPAIS','CLIDIRRF','CLILATITUDE','CLILONGITUDE','CLIFREG'),'global $_m¬IncLV;global $_m¬HTML;global $_m¬RASync;global $_m¬MED;global $_m¬CCERR;global $_m¬SS;global $_m¬PLG;global $_m¬SMTP;global $_m¬POP3;global $_m¬IMAPI;if(!isset($_m¬IncLV)){$_m¬IncLV=0;}if(!isset($_m¬RASync)){$_m¬RASync=array();}if(!isset($_m¬MED)){$_m¬MED=array();}global $_uX¬Res;$_x¬DBt=\'\';$_m¬DBdfc=\'\';$__¬DB=_¬Directorio((_¬True((_¬Exists(\'DBMYSQL.rt-odbc\')?\'True\':\'False\'))?\'DBMYSQL\':\'../DBMYSQL\'));if(_¬Odbc($__¬DB,\'_x¬DB\')){$_m¬DB->Name=_¬ClearIns($__¬DB);_¬DSet(\'_i¬DB_\'.$_m¬DB->Name,$_m¬DB,false);}else{_¬WErrEx(\'No Existe el Origen de Datos: \'.str_ireplace(\'.rt-odbc.php\',\'\',$__¬DB));}try{$_u¬Esp=\'CLIIP\';$_u¬VL=_¬GetInfo(\'CLIENTIP\',$_u¬Esp,\'\');_¬DSet($_u¬Esp,$_u¬VL);}catch(Exception $ex){_¬WErrEx(\'Error Parametrico: \'.$ex->getMessage());}$UPDRG=(_¬Event(\'CLIFREG\',true)?\'True\':\'False\');'.vbCrLf.'if(!_¬True($UPDRG)){$CLIFREG=_¬getDateX(str_replace(\';\',\':\',trim(\'NOW\')),\'\',\'\');}$_u¬P=_¬Prop(\'CLIPSCOD=[SQLNULL:[CLIPSCOD]:FT] CLIPAIS=[SQLNULL:[CLIPAIS]:FT] CLIDIRRF=[SQLNULL:[CLIDIRRF]:FT] CLILATITUDE=[SQLNULL:[CLILATITUDE]:FT] CLILONGITUDE=[SQLNULL:[CLILONGITUDE]:FT] XCLIFREG=[SQLDATE:[CLIFREG]:MYSQL] "XCND=CLIIP=\\\'[CLIIP]\\\' AND CLIFREG=[XCLIFREG] AND CLILATITUDE=[CLILATITUDE] AND CLILONGITUDE=[CLILONGITUDE] AND CLIPSCOD=\\\'\\\'"\');for($_u¬j=0;$_u¬j<count($_u¬P);$_u¬j++){$_u¬VL=trim(_¬Coax($_u¬P[$_u¬j]));if(!_¬IsNE($_u¬VL)){_¬ParseA($_u¬VL,\'=\',$_u¬NM);$_u¬NM=trim(_¬Coax($_u¬NM));if(!_¬IsNE($_u¬NM)){_¬DSet($_u¬NM,_¬Coax($_u¬VL));}}}'.vbCrLf.'if(_¬True($UPDRG)){$_t¬DB=$_m¬DB;$_u_Err=\'\';$_u¬SQL=trim(\' update geoclinav01 SET CLIPSCOD=\'.$CLIPSCOD.\', CLIPAIS=\'.$CLIPAIS.\', CLIDIRRF=\'.$CLIDIRRF.\' WHERE \'.$XCND);try{$_u¬NUP=0;if(!isset($_t¬DB)||is_null($_t¬DB)){_¬WErrEx(\'Primero debe generar un Schema, abrir una Base de Datos con DBOPEN o usar una Herramienta de Terceros, tambien puede usar DBCHANGE, si ya aperturo una conexion activa !!\',\'DBRUN update geoclinav01 SET CLIPSCOD=[CLIPSCOD], CLIPAIS=[CLIPAIS], CLIDIRRF=[CLIDIRRF] WHERE [XCND]\');}else{if(!$_t¬DB->RunSQL($_u¬SQL,$_u¬NUP)){$_u_Err=$_t¬DB->GetError();}_¬DSet(\'DBRUN_ROWS_UPDATE\',$_u¬NUP);}}catch(Exception $ex){$_u_Err=\'PROBLEM: \'.$ex->getMessage();}if(!_¬IsNE($_u_Err)){_¬WError(\'Error en el Comando SQL:<p>\'.$_u_Err,$_u¬SQL);}}else{$_t¬DB=$_m¬DB;$_u¬Err=\'\';$_u¬BUF=strtoupper(trim(\'TMPRGCLINAV\'));$_u¬SQL=\'insert into geoclinav01(CLIIP, CLIPSCOD, CLIPAIS, CLIDIRRF, CLILATITUDE, CLILONGITUDE, CLIFREG) VALUES(\\\'\'.$CLIIP.\'\\\', \'.$CLIPSCOD.\', \'.$CLIPAIS.\', \'.$CLIDIRRF.\', \'.$CLILATITUDE.\', \'.$CLILONGITUDE.\', \'.$XCLIFREG.\');select CLIFREG FROM geoclinav01 WHERE \'.$XCND;$_u¬VErr=\'\';if(!isset($_t¬DB)||is_null($_t¬DB)){_¬WErrEx(\'Primero debe generar un Schema, abrir una Base de Datos con DBOPEN o usar una Herramienta de Terceros, tambien puede usar DBCHANGE, si ya aperturo una conexion activa !!\',\'DBREAD \'.$_u¬BUF.\' \'.$_u¬SQL.\'\');}elseif(_¬IsNE($_u¬BUF)){$_u¬Err=$_u¬Err.\'Asigne un Nombre de Buffer o Instancia no Valido para la Consulta !! \'.vbCr;}elseif(!_¬IsNE($_u¬SQL)){$_u¬RErr=false;$_u¬TB=$_t¬DB->LectorSQL($_u¬SQL,$_u¬RErr);_¬DSet(\'_BF¬\'.$_u¬BUF,$_u¬TB);if($_u¬RErr){$_u¬Err=$_u¬Err.\'SQL: Se Produjo el Siguiente Error: \'.$_t¬DB->GetError().vbCr;}else{$_COUNT=$_u¬TB->RWS->Count();if($_COUNT>0&&count($_u¬TB->CLS)){$_FIRST=$_u¬TB->Cells(0,0);}else{$_FIRST=\'\';}_¬DSet($_u¬BUF,\'X-RT#X-RDB-TABLE#\'.$_t¬DB->Name.\'#\'.$_u¬BUF.\'#\');_¬DSet($_u¬BUF.\'_SQL\',$_u¬SQL);_¬RDBFetch($_u¬TB);$_COUNT=$_u¬TB->RWS->Count();if($_COUNT>0&&count($_u¬TB->CLS)){$_FIRST=$_u¬TB->Cells(0,0);}else{$_FIRST=\'\';}}}else{$_u¬Err=$_u¬Err.\'No se Localiza el parametro clave en la sentencia\'.vbCr;_¬DSet($_u¬BUF,\'\');}if(!_¬IsNE($_u¬VErr)){_¬DSet($_u¬VErr,$_u¬Err);}elseif(!_¬IsNE($_u¬Err)){_¬WError($_u¬Err,$_u¬SQL);}$_u¬VErr=\'\';}'.vbCrLf.'echo(\'OK\');if(isset($_uX¬Res)){_¬DSet($_uX¬Res,(!_¬IsNE(trim($_uT¬QQ=$_CLIFREG))?$_uT¬QQ:(!_¬IsNE(trim($_uT¬QQ=$CLIFREG))?$_uT¬QQ:\'\')));return _¬DGet($_uX¬Res);}else{_¬WError(\'Comando Return Fuera de Lugar\');}return _¬DGet($_uX¬Res);');?>